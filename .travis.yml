language: c
sudo: false
dist: trusty
script: make all && make test
matrix:
  include:
    - compiler: gcc
      env: CFLAGS="-std=c99 -O2 -Wall -Wextra -Werror -Wpedantic -pedantic-errors -Wno-clobbered"
        USE_VALGRIND=1
    - compiler: clang
      env: CFLAGS="-std=c99 -O2 -Wall -Wextra -Werror -Weverything -Wno-#warnings -Wno-pedantic -Wno-padded -Wno-format-nonliteral -Wno-disabled-macro-expansion -Wno-missing-noreturn -Wno-reserved-id-macro -Wno-cast-align"
        USE_VALGRIND=1
    - os: osx
      compiler: clang
      env: CFLAGS="-std=c99 -O2 -Wall -Wextra -Werror -Weverything -Wno-#warnings -Wno-pedantic -Wno-padded -Wno-format-nonliteral -Wno-disabled-macro-expansion -Wno-missing-noreturn -Wno-reserved-id-macro"
        USE_VALGRIND=0
env:
  global:
    - secure: "X6lt/dxOtQqLrnZAd35eBC7DE9J+mePHzuThMvh9i7gF1LKZdfaiG9UuH6gVobGYB+JqxZcblHAvnrGRRi8ASCunVDqZDtdXKnuCJJUaW4n9F+Fe94sYIwRYMNwTIEzlSnRbpNmrmOenHPAq4JR1MvLyz4AE0GpHeCCXl0Obx9xh4+ejP8mGoRn8P9Ueii1UMuQSBigdPAcOK7cbTrB7VrwdPbasfj+w23yJCrROg0/vzbKUIYVWaMBK8b3csOHhFYiqPpBpRQqV5jb5XLnkEBa0Hr60TrcQOEIpRy0rJZ2iKxqtfQBXRHTvbTWDlHf2PbYZqpzpDV40Ad2oC48akI4w0ynJBGR98hP5+mAtqzNfLhSNa6AL8ZUL9KTQZvKBMliIGNM1CBSLXBrVnP591idwT3rjeZCWYfr9vyFpyWdedtWYKA6svsjSf8Jd/brsPIZs3+SDHclWbi2jPGRDY8UL1Kd5x26w5l3fF0LTIs/pghNpLIhoRFYWOPCkqNJhqfbX/9fcy0JB3IvhnKEhCkRUTKhGKNuR/0BkRfiXkEIVquM+zz65F9ULiScwQ31P9cKPDezxAUs5nxfdQqb84k+4UAoRI7ErIC+gqQCD9c9iOM6smnJw/OG4Klco+mCKmyOXZPRDVFh1U41pvWotMo6tu2rvQqyh8AjPySUZm/8="
    - COVERITY_SCAN_PROJECT_NAME="Tarsnap/libcperciva"
    - COVERITY_SCAN_BRANCH_PATTERN="coverity-scan"
    - COVERITY_SCAN_NOTIFICATION_EMAIL="cperciva@tarsnap.com"
    - COVERITY_SCAN_BUILD_COMMAND_PREPEND="cd tests/buildall"
    - COVERITY_SCAN_BUILD_COMMAND="make all clean"
addons:
  apt:
    packages:
      - valgrind
before_install:
  - test $TRAVIS_BRANCH != coverity-scan -o ${TRAVIS_JOB_NUMBER##*.} = 1 || exit 0
  - curl -s "https://scan.coverity.com/scripts/travisci_build_coverity_scan.sh" | bash || true
  - test $TRAVIS_BRANCH != coverity-scan || exit 0
  - 'if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then export CFLAGS="-I/usr/local/opt/openssl/include $CFLAGS" LDFLAGS="-L/usr/local/opt/openssl/lib $LDFLAGS"; fi'
