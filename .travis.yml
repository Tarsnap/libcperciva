language: c
sudo: false
dist: trusty
script: make all && make test
matrix:
  include:
    - compiler: gcc
      env: CFLAGS="-std=c99 -O2 -Wall -Wextra -Werror -Wpedantic -pedantic-errors -Wno-clobbered"
        USE_VALGRIND=1
    - compiler: clang
      env: CFLAGS="-std=c99 -O2 -Wall -Wextra -Werror -Weverything -Wno-#warnings -Wno-pedantic -Wno-padded -Wno-format-nonliteral -Wno-disabled-macro-expansion -Wno-missing-noreturn -Wno-reserved-id-macro"
        USE_VALGRIND=1
    - os: osx
      compiler: clang
      env: CFLAGS="-std=c99 -O2 -Wall -Wextra -Werror -Weverything -Wno-#warnings -Wno-pedantic -Wno-padded -Wno-format-nonliteral -Wno-disabled-macro-expansion -Wno-missing-noreturn -Wno-reserved-id-macro"
        USE_VALGRIND=0
env:
  global:
    - secure: "ieBpKBmxyqohWOH9knvrwCJ77F9dmQ7Xj0nvmXXgjboIX2r9ty7ejAuY0s0cq5ilcVH4KGI6/370LE923jtteKwfalPaxaGrxo2BbpgsLvLeweS/38c4xuMERuWeSdC63X/LRvBQvrkVqrReYT9rAoSu6hGEODeCQE5RiRTtPt0OX56MxaXYcgODRjet5RYrzajIgzXS8CSGE3Yz0K30Awcq9hV4pJLMRFHK/X+kQwdpwj6piwwwAX3XR0kG9U+JTCGLBerkcF5RCLNxnkrbqaMhiTt1aCOY/fCVWd7lqjgOw90eX0EinJJw3GsntoG2RgHGZ/Zb5c6qeF4ghmmhpR5LXRIRbIVBPiyeaL24sttvPG0ZrXkFuogRZTBB0zLBMtSRRfjyT/QivRgTY5NSdWI4QsK/HXp/6fX9S4bqCsFuk+LC9rxcif0sTxfclMroRv5jHz+3BxYDem5LvIfGO6TfASvsGCbGDLc7u0JgqJh8Oim9AJCrab/A1b0soJDAUBVaEl7wswzf7BhETq7G10lfSTATtUVZ9QUIB67vO2CL8IgnSTP0zwDnP3a9bCqsVPDkrC8enbdbH1I1oGU3OKlXi74B4ubczhSei2d71jpuh4qfoTUF/pQyHhNEWf+UbssUGQYK4askqa1YkrtmlzxwuoQkPy7+lO/TiE7Lrgs="
    - COVERITY_SCAN_PROJECT_NAME="Tarsnap/libcperciva"
    - COVERITY_SCAN_BRANCH_PATTERN="coverity-scan"
    - COVERITY_SCAN_NOTIFICATION_EMAIL="cperciva@tarsnap.com"
    - COVERITY_SCAN_BUILD_COMMAND_PREPEND="cd tests/buildall"
    - COVERITY_SCAN_BUILD_COMMAND="make all clean"
addons:
  apt:
    packages:
      - valgrind
before_install:
  - test $TRAVIS_BRANCH != coverity-scan -o ${TRAVIS_JOB_NUMBER##*.} = 1 || exit 0
  - curl -s "https://scan.coverity.com/scripts/travisci_build_coverity_scan.sh" | bash || true
  - test $TRAVIS_BRANCH != coverity-scan || exit 0
  - 'if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then export CFLAGS="-I/usr/local/opt/openssl/include $CFLAGS" LDFLAGS="-L/usr/local/opt/openssl/lib $LDFLAGS"; fi'
